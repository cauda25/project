<!DOCTYPE html>
<html lang="ko">

  <head>
    <meta charset="UTF-8">
    <title>íšŒì›íƒˆí‡´ í™•ì¸</title>
    <style>
      body {
        text-align: center;
        font-family: Arial, sans-serif;
        padding: 50px;
        background-color: #f8f8f8;
      }

      .container {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px #aaa;
        display: inline-block;
      }

      h2 {
        color: #ff4c4c;
      }

      button {
        padding: 10px 20px;
        margin: 10px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
      }

      #confirmDelete {
        background: #ff4c4c;
        color: white;
      }

      #cancelDelete {
        background: #ccc;
      }
    </style>
  </head>

  <body>

    <div class="container">
      <h2>ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
      <button id="confirmDelete">ë„¤</button>
      <button id="cancelDelete">ì•„ë‹ˆì˜¤</button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const confirmButton = document.getElementById("confirmDelete");
        const cancelButton = document.getElementById("cancelDelete");

        let memberId;

        try {
          // âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ID ê°€ì ¸ì˜¤ê¸°
          const response = await fetch("/api/member/current", {
            method: "GET",
            credentials: "include",
            headers: {
              "Content-Type": "application/json"
            }
          });

          if (!response.ok) {
            throw new Error("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }

          const user = await response.json();
          memberId = user.mid; // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ID
          console.log("í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID:", memberId);

          if (!memberId) {
            alert("íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
            window.location.href = "/member/login";
            return;
          }
        } catch (error) {
          console.error("Error fetching user data:", error);
          alert("ë¡œê·¸ì¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          window.location.href = "/member/login";
          return;
        }

        if (confirmButton) {
          confirmButton.addEventListener("click", function () {
            console.log("íšŒì› íƒˆí‡´ ì§„í–‰...", memberId);

            fetch(`/member/${memberId}`, {
              method: "DELETE",
              credentials: "include",
              headers: {
                "Content-Type": "application/json"
              }
            })
              .then(response => {
                if (response.ok) {
                  alert("íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                  // ğŸ”¹ íƒˆí‡´ í›„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ & ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™
                  return fetch("/logout", {
                    method: "POST",
                    credentials: "include"
                  });
                } else {
                  throw new Error("íšŒì› íƒˆí‡´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
              })
              .then(() => {
                window.location.href = "/member/login"; // âœ… ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
              })
              .catch(error => {
                console.error("Error:", error);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              });
          });
        } else {
          console.error("âŒ 'confirmDelete' ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        if (cancelButton) {
          cancelButton.addEventListener("click", function () {
            window.location.href = "/"; // âœ… ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
          });
        }
      });
    </script>

  </body>

</html>
